<!-- MainWindow.xaml -->
<Window x:Class="SGService.LaserRangingModule.Monitor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:SGService.LaserRangingModule.Monitor.ViewModels"
        xmlns:enums="clr-namespace:SGService.LaserRangingModule.Monitor"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="LaserRangingModuleMonitor"
        Height="450" Width="800" UseLayoutRounding="True"
        SnapsToDevicePixels="True">
    <Window.Resources>
        <!-- 建立枚舉值集合供 ComboBox 使用 -->
        <ObjectDataProvider x:Key="RangeValues"
                            MethodName="GetValues"
                            ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <!-- 改為使用 enums 命名空間 -->
                <x:Type TypeName="enums:LrmRange"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
        <ObjectDataProvider x:Key="ResolutionValues"
                            MethodName="GetValues"
                            ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="enums:LrmResolution"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
        <ObjectDataProvider x:Key="FrequencyValues"
                            MethodName="GetValues"
                            ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="enums:LrmFrequency"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </Window.Resources>
    
    <Grid>
        <TabControl>
            <!-- Config 分頁 -->
            <TabItem Header="Config">
                <Grid Background="#FFE5E5E5">
                    <Grid Margin="12">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- 0: 掃描區 -->
                            <RowDefinition Height="Auto"/>
                            <!-- 1: 參數設定區 -->
                            <RowDefinition Height="*"/>
                            <!-- 2: 列表區 -->
                        </Grid.RowDefinitions>

                        <!-- 0: 扫描/加入區域（保持原樣） -->
                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="可用 COM：" VerticalAlignment="Center"/>
                            <ComboBox Grid.Column="2" Width="220"
                          ItemsSource="{Binding AvailablePorts}"
                          SelectedItem="{Binding SelectedPortName, Mode=TwoWay}"/>
                            <Button Grid.Column="4" Width="80" Content="掃描" Command="{Binding ScanCommand}"/>
                            <Button Grid.Column="6" Width="90" Content="加入" Command="{Binding AddSelectedPortCommand}"/>
                        </Grid>

                        <!-- 1: 新增的參數設定區 -->
                        <GroupBox Grid.Row="1" Header="參數設定" Margin="0,12,0,0"
                      IsEnabled="{Binding CanConfigureSelectedPort}">
                            <Grid Margin="8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="8"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Range -->
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Range" VerticalAlignment="Center"/>
                                <ComboBox Grid.Row="0" Grid.Column="2"
                              ItemsSource="{Binding Source={StaticResource RangeValues}}"
                              SelectedItem="{Binding RangeSetting}"
                              Width="150"/>

                                <!-- Resolution -->
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Resolution" VerticalAlignment="Center"/>
                                <ComboBox Grid.Row="1" Grid.Column="2"
                              ItemsSource="{Binding Source={StaticResource ResolutionValues}}"
                              SelectedItem="{Binding ResolutionSetting}"
                              Width="150"/>

                                <!-- Frequency -->
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Frequency" VerticalAlignment="Center"/>
                                <ComboBox Grid.Row="2" Grid.Column="2"
                              ItemsSource="{Binding Source={StaticResource FrequencyValues}}"
                              SelectedItem="{Binding FrequencySetting}"
                              Width="150"/>

                                <!-- Apply 按鈕 -->
                                <Button Grid.Row="3" Grid.Column="2" Content="Apply"
                            Command="{Binding ApplySettingsCommand}"
                            Width="80" Margin="0,12,0,0"/>
                            </Grid>
                        </GroupBox>

                        <!-- 2: 原有的 ItemsControl 列表 -->
                        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                            <!-- 此處維持你原本顯示 SelectedPorts 或 SelectedDevices 的實作 -->
                        </ScrollViewer>
                    </Grid>
                </Grid>
            </TabItem>



            <TabItem Header="Measurement">
                <Grid Background="#FFE5E5E5">
                    <Grid Margin="12" VerticalAlignment="Top">
                        <!-- 清單：綁 SelectedPorts -->
                        <ItemsControl ItemsSource="{Binding SelectedPorts}">
                            <!-- 空清單時顯示提示（可拿掉） -->
                            <ItemsControl.Style>
                                <Style TargetType="ItemsControl">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <Trigger Property="HasItems" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.Style>

                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Padding="8" Margin="0,0,0,8" BorderBrush="#DDD" BorderThickness="1" CornerRadius="4">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <!-- COM 標籤 -->
                                                <ColumnDefinition Width="12"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <!-- ADDR 標籤 -->
                                                <ColumnDefinition Width="6"/>
                                                <ColumnDefinition Width="90"/>
                                                <!-- ADDR 輸入框 -->
                                                <ColumnDefinition Width="12"/>
                                                <ColumnDefinition Width="*"/>
                                                <!-- 參數說明 -->
                                                <ColumnDefinition Width="Auto"/>
                                                <!-- Connect/Disconnect -->
                                                <ColumnDefinition Width="8"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <!-- 移除 -->
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0" Text="{Binding Port}" FontWeight="Bold" VerticalAlignment="Center"/>

                                            <TextBlock Grid.Column="2" Text="ADDR:" VerticalAlignment="Center"/>
                                            <TextBox Grid.Column="4"
                         Text="{Binding Address, UpdateSourceTrigger=PropertyChanged}"
                         HorizontalContentAlignment="Right"
                         VerticalContentAlignment="Center"
                         Height="28"
                         PreviewTextInput="Addr_PreviewTextInput"
                         DataObject.Pasting="Addr_Pasting"
                         IsReadOnly="{Binding IsConnected}"
                         ToolTip="0–255（連線後會鎖定）"/>

                                            <TextBlock Grid.Column="6" Text="Serial: 9600-8-N-1"
                           VerticalAlignment="Center" Opacity="0.85"/>

                                            <!-- 若你已改成 MVVM 命令 -->
                                            <Button Grid.Column="7" Width="100"
                        Content="{Binding ConnectButtonText}"
                        Command="{Binding ToggleConnectCommand}"/>
                                            <Button Grid.Column="9" Width="80" Content="移除"
                        Command="{Binding RemoveCommand}"/>

                                            
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- 空清單提示（可選） -->
                        <!-- Measurement 分頁底部，空清單提示 -->
                        <TextBlock Margin="0,12,0,0"
           FontStyle="Italic"
           Foreground="#666"
           Text="尚未加入任何裝置，請到 Config 分頁選擇 COM 並按「加入」。">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <!-- 預設隱藏 -->
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <!-- 當清單為空時顯示 -->
                                        <DataTrigger Binding="{Binding SelectedPorts.Count}" Value="0">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                    </Grid>
                </Grid>
            </TabItem>

        </TabControl>
    </Grid>
</Window>
