<Window x:Class="SGService.LaserRangingModule.Monitor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:SGService.LaserRangingModule.Monitor.ViewModels"
        mc:Ignorable="d"
        Title="LaserRangingModuleMonitor"
        Height="450" Width="800"
        UseLayoutRounding="True" SnapsToDevicePixels="True">

    <Grid>
        <TabControl>
            <TabItem Header="Config">
                <Grid Background="#FFE5E5E5">
                    <Grid Margin="12" VerticalAlignment="Top">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- 工具列 -->
                            <RowDefinition Height="*"/>
                            <!-- 保留空間 -->
                        </Grid.RowDefinitions>

                        <!-- Row 0：上方工具列 -->
                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="可用 COM：" VerticalAlignment="Center"/>
                            <ComboBox Grid.Column="2" Width="220"
                  ItemsSource="{Binding AvailablePorts}"
                  SelectedItem="{Binding SelectedPortName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <Button Grid.Column="4" Width="80" Content="掃描"
                Command="{Binding ScanCommand}"/>
                            <Button Grid.Column="6" Width="90" Content="加入"
                Command="{Binding AddSelectedPortCommand}"/>
                        </Grid>
                    </Grid>
                </Grid>
            </TabItem>


            <TabItem Header="Measurement">
                <Grid Background="#FFE5E5E5">
                    <Grid Margin="12" VerticalAlignment="Top">
                        <!-- 清單：綁 SelectedPorts -->
                        <ItemsControl ItemsSource="{Binding SelectedPorts}">
                            <!-- 空清單時顯示提示（可拿掉） -->
                            <ItemsControl.Style>
                                <Style TargetType="ItemsControl">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <Trigger Property="HasItems" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.Style>

                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Padding="8" Margin="0,0,0,8" BorderBrush="#DDD" BorderThickness="1" CornerRadius="4">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <!-- COM 標籤 -->
                                                <ColumnDefinition Width="12"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <!-- ADDR 標籤 -->
                                                <ColumnDefinition Width="6"/>
                                                <ColumnDefinition Width="90"/>
                                                <!-- ADDR 輸入框 -->
                                                <ColumnDefinition Width="12"/>
                                                <ColumnDefinition Width="*"/>
                                                <!-- 參數說明 -->
                                                <ColumnDefinition Width="Auto"/>
                                                <!-- Connect/Disconnect -->
                                                <ColumnDefinition Width="8"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <!-- 移除 -->
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0" Text="{Binding Port}" FontWeight="Bold" VerticalAlignment="Center"/>

                                            <TextBlock Grid.Column="2" Text="ADDR:" VerticalAlignment="Center"/>
                                            <TextBox Grid.Column="4"
                         Text="{Binding Address, UpdateSourceTrigger=PropertyChanged}"
                         HorizontalContentAlignment="Right"
                         VerticalContentAlignment="Center"
                         Height="28"
                         PreviewTextInput="Addr_PreviewTextInput"
                         DataObject.Pasting="Addr_Pasting"
                         IsReadOnly="{Binding IsConnected}"
                         ToolTip="0–255（連線後會鎖定）"/>

                                            <TextBlock Grid.Column="6" Text="Serial: 9600-8-N-1"
                           VerticalAlignment="Center" Opacity="0.85"/>

                                            <!-- 若你已改成 MVVM 命令 -->
                                            <Button Grid.Column="7" Width="100"
                        Content="{Binding ConnectButtonText}"
                        Command="{Binding ToggleConnectCommand}"/>
                                            <Button Grid.Column="9" Width="80" Content="移除"
                        Command="{Binding RemoveCommand}"/>

                                            <!-- 如果你目前仍是 Click 版本，改成：
                <Button Grid.Column="7" Width="100"
                        Content="{Binding ConnectButtonText}"
                        Click="RowConnectButton_Click" Tag="{Binding}"/>
                <Button Grid.Column="9" Width="80" Content="移除"
                        Click="RowRemoveButton_Click" Tag="{Binding}"/> -->
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- 空清單提示（可選） -->
                        <TextBlock Margin="0,12,0,0" FontStyle="Italic" Foreground="#666"
                 Text="尚未加入任何裝置，請到 Config 分頁選擇 COM 並按「加入」。">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedPorts.Count}" Value="0">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding SelectedPorts.Count}" Value="1">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Grid>
                </Grid>
            </TabItem>

        </TabControl>
    </Grid>
</Window>
